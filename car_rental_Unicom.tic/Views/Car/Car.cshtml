@model List<car_rental_Unicom.tic.View_modal.car_add_view_modal>

@{
    ViewData["Title"] = "Car Page"; // Page title
}

<h2 class="mb-4">Car Page</h2>

<!-- 🔹 Add Car Button -->
<button type="button" class="btn btn-primary mb-3" onclick="callAddCar()">Add Car</button>

<!-- 🔹 Main View Cars Button (ஒரே button, controller GET action call பண்ணும்) -->
<button type="button" class="btn btn-success mb-3" onclick="viewAllCars()">View Cars</button>

<!-- 🔹 Non Available Button -->
<button type="button" class="btn btn-warning mb-3" onclick="filterNonAvailable()">Non Available</button>

<!-- 🔹 Car cards container -->
<div class="row" id="carContainer">
    @* Page load-ல எந்த car card-ஐ display பண்ண வேண்டுமோ controller-ல் இருந்து வந்த data-ல பண்ணும் *@
    @if (Model != null && Model.Count > 0)
    {
        @foreach (var car in Model)
        {
            <div class="col-md-4 mb-4 car-card" data-status="@car.ac">
                <div class="card shadow-sm h-100">

                    <!-- 🔹 Image Carousel / Show max 3 images -->
                    <div id="carousel@car.CarId" class="carousel slide" data-bs-ride="carousel">
                        <div class="carousel-inner">
                            @{
                                var images = car.ImagePaths != null ? car.ImagePaths.Take(3).ToList() : new List<string> { "/images/no-image.png" };
                            }
                            @for (int i = 0; i < images.Count; i++)
                            {
                                <div class="carousel-item @(i == 0 ? "active" : "")">
                                    <img src="@images[i]" class="d-block w-100" style="height:200px;object-fit:cover;" />
                                </div>
                            }
                        </div>

                        @if (images.Count > 1)
                        {
                            <button class="carousel-control-prev" type="button" data-bs-target="#carousel@car.CarId" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon"></span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#carousel@car.CarId" data-bs-slide="next">
                                <span class="carousel-control-next-icon"></span>
                            </button>
                        }
                    </div>

                    <!-- 🔹 Card Body -->
                    <div class="card-body">
                        <h5 class="card-title">@car.Car_modalName</h5>
                        <p class="card-text mb-1"><strong>Year:</strong> @car.year</p>
                        <p class="card-text mb-1"><strong>Rent per Day:</strong> Rs. @car.RentPerDay</p>

                        <!-- 🔹 AC switch -->
                        <div class="form-check form-switch mt-2">
                            <input class="form-check-input" type="checkbox" role="switch" id="acSwitch@car.CarId" @(car.ac == "Available" ? "checked" : "") onchange="toggleAC('@car.CarId')">
                            <label class="form-check-label" for="acSwitch@car.CarId">AC</label>
                        </div>
                    </div>
                </div>
            </div>
        }
    }
    else
    {
        <p>No cars available.</p>
    }
</div>

<script>
    // 🔹 Add Car page-க்கு redirect பண்ணும் function
    function callAddCar() {
        window.location.href = '/Car/add_car';
    }

    // 🔹 Main button click ஆனதும் controller GET action call பண்ணும் function
    function viewAllCars() {
        // 🔹 MVC controller-ல GET request அனுப்பி page reload பண்ணும்
        window.location.href = '/Car/ViewCars';
    }

    // 🔹 Non Available cars filter function
    function filterNonAvailable() {
        let cards = document.querySelectorAll('.car-card');
        cards.forEach(card => {
            card.style.display = card.getAttribute('data-status') === "Not_Available" ? "block" : "none";
        });
    }

    // 🔹 AC switch toggle
    function toggleAC(carId) {
        let switchElem = document.getElementById('acSwitch' + carId);
        let status = switchElem.checked ? "Available" : "Not_Available";
        let card = switchElem.closest('.car-card');
        card.setAttribute('data-status', status); // 🔹 card-ல data-status update
        console.log("CarId: " + carId + ", AC Status: " + status);
    }
</script>
