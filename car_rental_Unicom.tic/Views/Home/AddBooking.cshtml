@model car_rental_Unicom.tic.Vew_modal.home_view_modal

@{
    ViewData["Title"] = "Book Car";
}

<!-- Bootstrap மேலும் JQuery இணைப்பு (UI மற்றும் date picker க்கு) -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>

<div class="container mt-4">
    <h2>Book Car <!-- கார் முன்பதிவு செய்யவும் --></h2>

    <!-- கார் விவரங்கள் காட்டும் பகுதி -->
    <div class="card mb-4">
        <div class="row g-0">
            <div class="col-md-4">
                <!-- கார் படம் -->
                <img src="@Model.image_path" class="img-fluid rounded-start" alt="@Model.Car_modalName" />
            </div>
            <div class="col-md-8">
                <div class="card-body">
                    <!-- கார் பெயர் மற்றும் ஆண்டு -->
                    <h5 class="card-title">@Model.Car_modalName (@Model.year)</h5>
                    <p class="card-text">
                        <!-- கார் விவரங்கள் -->
                        Number Plate: @Model.number_plact<br />
                        AC: @Model.ac<br />
                        Top Speed: @Model.top_speed<br />
                        Gear System: @Model.Gear_System<br />
                        Milage: @Model.milage<br />
                        Status: @Model.car_status<br />
                        Maintenance Charge: @Model.MaintenanceCharge<br />
                        Rent Per Day: @Model.RentPerDay
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- முன்பதிவு form ஆரம்பம் -->
    <form asp-action="AddBooking" method="post" class="mb-4">
        <!-- கார் Id (மறைபுரிய) -->
        <input type="hidden" asp-for="CarId" />
        <div class="mb-3">
            <!-- உரிமம் எண் (License Number) -->
            <label asp-for="licence_number" class="form-label">License Number <!-- உரிமம் எண் --></label>
            <input asp-for="licence_number" class="form-control" required />
            <span asp-validation-for="licence_number" class="text-danger"></span>
        </div>
        <div class="mb-3">
            <!-- தொடக்க தேதி (Start Date) -->
            <label asp-for="start_date" class="form-label">Start Date <!-- தொடக்க தேதி --></label>
            <input asp-for="start_date" type="date" class="form-control" id="startDate" required />
            <span asp-validation-for="start_date" class="text-danger"></span>
        </div>
        <div class="mb-3">
            <!-- நாட்கள் எண்ணிக்கை (Number of Days) -->
            <label asp-for="dayes" class="form-label">Number of Days <!-- நாட்கள் --></label>
            <input asp-for="dayes" class="form-control" required />
            <span asp-validation-for="dayes" class="text-danger"></span>
        </div>
        <!-- முன்பதிவு செய்யும் பொத்தான் -->
        <button type="submit" class="btn btn-success">Book Now <!-- முன்பதிவு செய்யவும் --></button>
        <!-- ரத்து செய்யும் பொத்தான் -->
        <a asp-action="Index" class="btn btn-secondary">Cancel <!-- ரத்து செய்யவும் --></a>
    </form>
    <!-- முன்பதிவு form முடிவு -->
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        $(document).ready(function () {
            // Server-இல் இருந்து முன்பதிவு செய்யப்பட்ட தேதிகளை பெறும் JS
            $.get('@Url.Action("GetBookedDates", "Home", new { carId = Model.CarId })', function (data) {
                var bookedDates = data; // "yyyy-MM-dd" string array
                $("#startDate").on("input", function () {
                    var selected = $(this).val();
                    // முன்பதிவு செய்யப்பட்ட தேதி தேர்வு செய்தால், எச்சரிக்கை காட்டும்
                    if (bookedDates.includes(selected)) {
                        alert("இந்த தேதி முன்பதிவு செய்யப்பட்டுள்ளது. மற்றொரு தேதியை தேர்வு செய்யவும்.");
                        $(this).val("");
                    }
                });
                // date picker-ல் இன்று முதல் மட்டும் தேர்வு செய்ய அனுமதி
                $("#startDate").attr("min", new Date().toISOString().split('T')[0]);
                $("#startDate").on("focus", function () {
                    var input = this;
                    input.addEventListener('keydown', function (e) {
                        var val = input.value;
                        // Manual entry-யில் முன்பதிவு செய்யப்பட்ட தேதியை தடுக்கும்
                        if (bookedDates.includes(val)) {
                            e.preventDefault();
                        }
                    });
                });
            });
        });
    </script>
}
